# 网盘资源搜索插件

这是一个用于搜索、转存和分享网盘资源的插件。目前支持夸克网盘和百度网盘。

## 功能特点

- 多线程搜索：同时从多个来源搜索资源
- 自动转存：将搜索到的资源自动转存到自己的网盘
- 分享链接：自动生成分享链接并回复给用户
- 过期清理：定期清理过期资源
- 广告过滤：自动过滤掉资源中的广告文件
- 广告添加：可以自动在分享的资源中添加预定义的广告文件
- 多账号支持：支持配置多个网盘账号，灵活切换

## 使用方法

1. 将插件放置在 `plugins` 目录下
2. 复制 `config.json.template` 为 `config.json`，并填写相关配置
3. 重启 Dify 服务

## 支持的命令

- `搜:关键词` - 搜索资源
- `搜索:关键词` - 搜索资源

例如：
```
搜:三体
搜索:复仇者联盟
```

## 配置文件说明

```json
{
  "general": {
    "expired_time": 30
  },
  "advertisement": {
    "enable_filter": true,
    "insert_on_share": true,
    "filter_keywords": [...]
  },
  "accounts": [
    {
      "id": "quark_main",
      "type": "quark",
      "enable": true,
      "cookie": "夸克网盘的Cookie",
      "save_dir": "夸克网盘的保存目录ID",
      "insert_ad": true,
      "ad_file_ids": [
        "广告文件ID1",
        "广告文件ID2"
      ]
    },
    {
      "id": "baidu_main",
      "type": "baidu",
      "enable": false,
      "cookie": "百度网盘的Cookie",
      "save_dir": "百度网盘的保存目录名",
      "insert_ad": true,
      "ad_file_ids": [
        "广告文件ID1"
      ]
    }
  ]
}
```

### 配置项说明

#### general 部分
- `expired_time`：资源过期时间（分钟），默认为30分钟

#### advertisement 部分
- `enable_filter`: 是否启用广告过滤功能，`true`或`false`
- `insert_on_share`: 是否在分享时插入广告（全局开关），`true`或`false`
- `filter_keywords`: 广告过滤关键词列表，用于识别和过滤掉资源中的广告文件

#### accounts 部分
每个网盘账号的配置包含以下字段：
- `id`: 账号唯一标识符（自定义）
- `type`: 账号类型，目前支持 `quark` 和 `baidu`
- `enable`: 是否启用此账号，`true`或`false`
- `cookie`: 网盘账号的Cookie
- `save_dir`: 资源保存目录
- `insert_ad`: 是否为此账号添加广告，`true`或`false`
- `ad_file_ids`: 此账号使用的广告文件ID列表

您可以添加多个同类型的账号，通过设置 `enable` 字段来控制哪个账号生效。

### 广告功能说明

#### 广告过滤
当下载资源时，插件会自动检查资源中的文件名，如果文件名包含配置中的广告关键词，则会自动删除这些文件。这有助于清理资源中的广告文件。

#### 广告添加
插件支持在转存的资源中添加预定义的广告文件。广告添加功能受到三个因素控制：
1. 全局的 `insert_on_share` 开关
2. 账号级别的 `insert_ad` 开关
3. 账号的 `ad_file_ids` 列表是否有内容

只有当上述三个条件都满足时，插件才会在分享资源时添加广告文件。广告文件是通过文件ID指定的，因此您需要在网盘中事先准备好这些文件。

如果转存的是文件夹，广告文件会被添加到该文件夹中；如果是单个文件，广告文件会被添加到同一目录下。

### 获取网盘Cookie

#### 夸克网盘
1. 登录夸克网盘网页版
2. 打开浏览器开发者工具（F12）
3. 切换到"网络"标签页
4. 刷新页面
5. 在请求列表中找到任意一个请求，查看"请求标头"中的"Cookie"值

#### 百度网盘
1. 登录百度网盘网页版
2. 同样使用浏览器开发者工具获取Cookie

### 获取夸克网盘目录ID

1. 在夸克网盘中创建一个专门用于转存的文件夹
2. 进入该文件夹
3. 查看浏览器地址栏，地址格式为 `https://pan.quark.cn/list#/list/all/xxxxx`
4. 其中 `xxxxx` 部分就是文件夹ID

### 获取广告文件ID

1. 在夸克网盘中上传或创建您想用作广告的文件（图片、PDF等）
2. 右键点击该文件，选择"获取链接"
3. 在链接中，形如 `https://pan.quark.cn/s/xxxxxxxx` 的部分，xxxxxxxx 即为文件ID
4. 或者您可以查看网络请求中文件操作API的响应，其中会包含文件的fid

## 注意事项

- 为避免被封号，建议合理使用，不要频繁调用
- 资源默认保存30分钟后自动删除
- 请确保网盘账号有足够空间用于转存文件 